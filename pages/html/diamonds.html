<style>
div.productDetail * {
  font-size:18px;
  font-weight: bold;
}
.yadcf-filter-range-number.yadcf-filter-range {
  width:100px !important;
}
div.productDetail span {
  font-size:14px;
  font-weight: bold;
}
#products_wrapper {
  margin-top:30px;
}
#mainNavbar {
  position: absolute;
  right: 0px;
}
#navigationTable {
  width:100%;
  max-width:100%;
}
#products td:nth-of-type(3),#products td:nth-of-type(11),#products td:nth-of-type(12),
#products td:nth-of-type(5),#products td:nth-of-type(6),
#products td:nth-of-type(7),#products td:nth-of-type(8), #products td:nth-of-type(10) {
  display:none !important;
}
 #products_temp td:nth-of-type(12),#products_temp td:nth-of-type(3),
 #products_temp td:nth-of-type(9), #products_temp td:nth-of-type(10),#products_temp td:nth-of-type(11)  {
  display:none !important;
}
#products_temp tr td {
  font-size: 12px;
}
#navigationTable td {

  vertical-align: center;
}
  table.dataTable tbody tr {
    /* min-height: 70px; */
  }
  table.dataTable tbody tr td img {
    width:150px !important;
  }
  .dataTables_length, .dataTables_filter {
    display:none!important;
  }
  td {
    vertical-align: bottom;
  }
  .dataTables_scrollHeadInner {
    width:100%;
  }
/*  #products td:nth-of-type(1),#products td:nth-of-type(2),#products td:nth-of-type(3),#products td:nth-of-type(5n),
  #products td:nth-of-type(6n),#products td:nth-of-type(7n),#products td:nth-of-type(8),F(10) td:nth-of-type(9),
  #products td:nth-of-type(10),#products td:nth-of-type(11), #products td:nth-of-type(12),#products td:nth-of-type(13) {
    display:none !important;
  }*/
  .yadcf-filter-reset-button  {
     display: none !important;
  }
  #filter-name {
    clear:both;
  }
  #yadcf-filter--products-2 {
    min-width: 300px !important;
  }
  #yadcf-filter--products-from-5,#yadcf-filter--products-to-5 {
    width: 100px;
  }
  .filter-div {
    width: 100%;
    padding-top: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid black;
  }
  .select2-selection.select2-selection--multiple {
    max-width:50% !important;
  }
#currency {
display:none !important;
}
</style>
<script type="text/javascript">
    $.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null) {
       return null;
    }
    return decodeURI(results[1]) || 0;
  }
</script>

<div>
<div style="margin:-1px auto;height:35px;background-color: white;">
<span style="font-size:28px;position:absolute;left:10px;margin-top:5px;">Diamonds</span>

<!--    <img style="cursor:pointer;position:absolute;top:20px;right:45px;width:20px;" data-toggle="modal" data-target="#filters" src="/coster/www/images/filtericon.png" /> -->
  <span style="position: absolute;right:70px;top:7px;">
    <select id="ssort" onchange="sortTable();" class="form-control">
      <option value="4">CARAT</option>
      <option value="7">PRICE</option>
    </select>
    </span><div id="sortOrder" onclick="$(this).toggleClass('asc');sortTable();" class="sort"></div>
      <img main style="cursor:pointer;position:fixed;top:63px;right:18px;width:20px;"  onclick="toggleFilters();" src="http://85.214.165.56:81/coster/www/images/filtericon.png" />
</div>
<div id="items_div" style="">
<div id="selectedFilters" style="left:13px;font-size:11px;padding-top: 5px;width:100%;min-width:100%;padding-right:20px;background-color:white;padding-bottom:15px;">
</div>
</div>
</div>
<div style="display:none">
<select class="form-control" id="currency" style="display:none;margin-top:-50px;">
<option value="EUR" rate="1">Euro</option>
</select>
</div>

<table id="products" class="display" style="display:none;min-width:100%;">
<thead>
  <tr>
    <th>Serial No</th>
    <th>Loc.</th>
    <th style="display:none;">ArticleNo</th>
    <th style="display:none;">ID</th>
    <th>Cut</th>
    <th style="">Weight</th>
    <th style="">Color</th>
    <th style="">Clarity</th>
    <th>Price</th>
    <th style="display:none;">SerialName</th>
    <th style="display:none;">SerialName</th>
      <th style="display:none;">Warrehouseid</th>
  </tr>
</thead>
<tbody>
</tbody>
</table>

<div class="modal" tabindex="-1" role="dialog" id="productDetail">
<div class="modal-dialog" role="document">
<div class="modal-content">
  <div class="modal-header">
    <h5 class="modal-title"><strong id="title">Modal title</strong></h5>
  </div>

  <div class="modal-footer" >
    <button type="button" id="ati" data-dismiss="modal"  onclick="checkAddToInvoice(this);"
      class="btn-bigblack"><span style="width:100%;text-align:left;margin-top:5px;">ADD TO BAG</span></button>
  </div>
</div>
</div>
</div>
<div class="modal" tabindex="-1" role="dialog" id="filters">
<div class="modal-dialog" role="document">
<div class="modal-content">
  <div class="modal-header">
    <h5 class="modal-title"><strong id="title">Filters</strong></h5>
  </div>
  <div class="modal-body" id="filters_body">

  </div>
  <div class="modal-footer" >
    <button type="button" class="btn btn-primary" data-dismiss="modal">Set</button>
  </div>
</div>
</div>
</div>
<div id="filters_temp" style="visibility:hidden;">
<form>
<div class="row">
  <div class="col-xs-12 filter-div"  style="float:left;">
    <strong>Name</strong>
    <div id="filter_name" ></div>
  </div>

</div>
<div class="row">
  <div class="col-xs-12 filter-div"  style="float:left;">
    <strong>Item ID</strong>
    <div id="filter_itemid" ></div>
  </div>

</div>
<div class="row">
  <div class="col-xs-12 filter-div"  style="float:left;">
    <strong>Price</strong>
    <div id="filter_price" ></div>
  </div>

</div>
<div class="row">
  <div class="col-xs-12 filter-div"  style="float:left;">
    <strong>Weight</strong>
    <div id="filter_weight" ></div>
  </div>

</div>
    <div class="row">
      <div class="col-xs-12 filter-div"  style="float:left;">
        <strong>Cut</strong>
        <div id="filter_cut" ></div>
      </div>

    </div>

    <div class="row">
      <div class="col-xs-12 filter-div"  style="float:left;">
        <strong>Location</strong>
        <div id="filter_locations" ></div>
      </div>

    </div>

    <div class="row">
      <div class="col-xs-12 filter-div"  style="float:left;">
        <strong>Color</strong>
        <div id="filter_color" ></div>
      </div>

    </div>
    <div class="row">
      <div class="col-xs-12 filter-div"  style="float:left;">
        <strong>Clarity</strong>
        <div id="filter_clarity" ></div>
      </div>

    </div>

</form>
</div>

<div id="div_filter" style="display:none;text-align:center;font-family:'Open Sans'";>
<div showfilters id="filters_container">
 <div style="min-width:100%;width:100%;color:black;font-size:18px;text-align:left;padding:7%;">
   <div class="filters" style="margin-top:10px;">
     <table style="width:100%;"><tr>
        <td style="width:25px;"><img src="http://85.214.165.56:81/coster/www/images/x.png" style="float:left;width:15px;" onclick="toggleFilters();" /></td>
        <td style="text-align:left;vertical-align:bottom;"><span style="font-size:14px;float:left;">FILTER AND SORT RESULTS<span></td>
        <td><span onclick="$('.all').trigger('click');toggleFilters();selectedFilters();" style="float:left;font-size:14px;margin-top:0px;">Reset</span></td>
        <td><span id="apply" onclick="yadcf.exFilterExternallyTriggered(dTable);toggleFilters();selectedFilters();sortTable();" style="float:right;font-size:14px;margin-top:0px;">Apply</span></td></tr></table>

    </div>


    <div class="filters border">
      <div style="padding-top:5px;padding-bottom:5px;margin-top:30px;">
       <span onclick="showFilters('itemid','Item ID');" style="float:left;">Item ID</span>
       <span onclick="$('#flitemid').val('');$('#itemidSelected').html('');yadcf.exResetFilters(dTable, [2]);" class="all">All</span>
     </div>
     <span id="itemidSelected" style="float:left;font-size:10px;opacity:0.6;"></span>
   </div>

    <div class="filters border">
        <div style="padding-top:5px;padding-bottom:5px;">
          <span onclick="showFilters('price','Price');" style="float:left;">Price</span>
          <span onclick="$('#prfrom').val('');$('#prto').val('');$('#priceSelected').html('');yadcf.exResetFilters(dTable, [8]);" class="all">All</span>
        </div>
      <span id="priceSelected" style="float:left;font-size:10px;opacity:0.6;"></span>
    </div>

    <div class="filters border">
       <div style="padding-top:5px;padding-bottom:5px;">
         <span onclick="showFilters('weight','Weight');" style="float:left;">Carat</span>
        <span onclick="$('#wgfrom').val('');$('#wgto').val('');$('#weightsSelected').html('');yadcf.exResetFilters(dTable, [4]);" class="all">All</span>
      </div>
      <span id="weightsSelected" style="float:left;font-size:10px;opacity:0.6;"></span>
    </div>

    <div class="filters border">
      <div style="padding-top:5px;padding-bottom:5px;">
        <span onclick="showFilters('locations','Location');" style="float:left;">Location</span>
        <span onclick="uncheckOptions('locations_options');$('#locationsSelected').html('');yadcf.exResetFilters(dTable, [1]);" class="all">All</span>
      </div>
      <span id="locationsSelected" style="float:left;font-size:10px;opacity:0.6;"></span>
    </div>

    <div class="filters border">
      <div style="padding-top:5px;padding-bottom:5px;">
        <span onclick="showFilters('cut','Cut');" style="float:left;">Cut</span>
        <span onclick="uncheckOptions('cut_options');$('#cutSelected').html('');yadcf.exResetFilters(dTable, [3]);" class="all">All</span>
      </div>
      <span id="cutSelected" style="float:left;font-size:10px;opacity:0.6;"></span>
    </div>

    <div class="filters border">
       <div style="padding-top:5px;padding-bottom:5px;">
       <span onclick="showFilters('clarity','Clarity');" style="float:left;">Clarity</span>
       <span onclick="uncheckOptions('clarity_options');$('#claritySelected').html('');yadcf.exResetFilters(dTable, [6]);" class="all">All</span>
     </div>
      <span id="claritySelected" style="float:left;font-size:10px;opacity:0.6;"></span>
    </div>


    <div class="filters border">
       <div style="padding-top:5px;padding-bottom:5px;">
       <span onclick="showFilters('colour','Colour');" style="float:left;">Colour</span>
       <span onclick="uncheckOptions('colour_options');$('#colourSelected').html('');yadcf.exResetFilters(dTable, [5]);" class="all">All</span>
     </div>
      <span id="colourSelected" style="float:left;font-size:10px;opacity:0.6;"></span>
    </div>

    <button onclick="yadcf.exFilterExternallyTriggered(dTable);toggleFilters();" class="btn-black" style="display:none;left:5%;position:absolute;bottom:20px;min-width:90%;width:90%;">CONFIRM</button>

 </div>
</div>




</div>

<div class="executefilters" id="itemid" style="display:none;">
 <div  class="filter_group">
     <div onclick="closeFilter('itemid');" class="arrow_left"></div>
     <span onclick="closeFilter('itemid');">Item ID</span>
 </div>
 <div class="options" id="itemid_options">
   <div class="row">
     <div class="col-xs-12 col-md-12 col-lg-12">
       <input id="flitemid" onclick="fireItemID();" placeholder="From"  class="form-control" />
     </div>

   </div>
   <button class="btn-black" onclick="fireItemID(true);" style="margin-top:10px;margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>

 </div>
</div>
<div class="executefilters" id="price" style="display:none;">
   <div  class="filter_group">
         <div onclick="closeFilter('price');" class="arrow_left"></div>
       <span onclick="closeFilter('price');">Price</span>
     <!--  <div class="pretty p-fill p-switch" style="float:right;margin-top:5px;font-size:15px;">
         <input onchange="" type="checkbox" />
         <div class="state p-success">
             <label>All</label>
         </div>
     </div> -->
   </div>
   <div class="options" id="price_options">
     <div class="row">
       <div class="col-xs-6 col-md-6 col-lg-6">
         <input id="prfrom" onchange="firePrice();" placeholder="From" type="number" class="form-control" />
       </div>
       <div class="col-xs-6 col-md-6 col-lg-6">
         <input id="prto" onchange="firePrice();" type="number" placeholder="To"  class="form-control" />
       </div>
     </div>
     <button class="btn-black" onclick="firePrice(true);" style="margin-top:10px;margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>

   </div>
</div>

<div class="executefilters" id="cut" style="display:none;">
   <div  class="filter_group">
         <div onclick="closeFilter('cut');" class="arrow_left"></div>
       <span onclick="closeFilter('cut');">Cut</span>
       <div class="pretty p-fill p-switch" style="float:right;margin-top:5px;font-size:15px;">
         <input onchange="selectDeselect(this);" type="checkbox" />
         <div class="state p-success">
             <label>All</label>
         </div>
     </div>
   </div>
   <div class="options" id="cut_options">
     <button class="btn-black" onclick="fireCut(true);" style="margin-top:10px;margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>

   </div>
</div>

<div class="executefilters" id="weight" style="display:none;">
   <div  class="filter_group">
         <div onclick="closeFilter('weight');" class="arrow_left"></div>
       <span onclick="closeFilter('weight');">Carat</span>
   </div>
   <div class="options" id="weight_options">
     <div class="row">
       <div class="col-xs-6 col-md-6 col-lg-6">
         <input id="wgfrom" onchange="fireWeight();" placeholder="From" type="number" class="form-control" />
       </div>
       <div class="col-xs-6 col-md-6 col-lg-6">
         <input id="wgto" onchange="fireWeight();" type="number" placeholder="To"  class="form-control" />
       </div>
     </div>
     <button class="btn-black" onclick="fireWeight(true);" style="margin-top:10px;margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>

   </div>
</div>
<div class="executefilters" id="clarity" style="display:none;">
    <div  class="filter_group">
          <div onclick="closeFilter('clarity');" class="arrow_left"></div>
        <span onclick="closeFilter('clarity');">Clarity</span>
        <div class="pretty p-fill p-switch" style="float:right;margin-top:5px;font-size:15px;">
          <input onchange="selectDeselect(this);" type="checkbox" />
          <div class="state p-success">
              <label>All</label>
          </div>
      </div>
    </div>
    <div class="options" id="clarity_options">
      <button class="btn-black" onclick="fireClarity(true);" style="margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>
    </div>
</div>

<div class="executefilters" id="locations" style="display:none;">
    <div  class="filter_group">
          <div onclick="closeFilter('locations');" class="arrow_left"></div>
        <span onclick="closeFilter('locations');">Locations</span>
        <div class="pretty p-fill p-switch" style="float:right;margin-top:5px;font-size:15px;">
          <input onchange="selectDeselect(this);" type="checkbox" />
          <div class="state p-success">
              <label>All</label>
          </div>
      </div>
    </div>
    <div class="options" id="locations_options">
      <button class="btn-black" onclick="fireLocations(true);" style="margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>
    </div>
</div>


<div class="executefilters" id="colour" style="display:none;">
    <div  class="filter_group">
          <div onclick="closeFilter('colour');" class="arrow_left"></div>
        <span onclick="closeFilter('colour');">Colour</span>
        <div class="pretty p-fill p-switch" style="float:right;margin-top:5px;font-size:15px;">
          <input onchange="selectDeselect(this);" type="checkbox" />
          <div class="state p-success">
              <label>All</label>
          </div>
      </div>
    </div>
    <div class="options" id="colour_options">
      <button class="btn-black" onclick="fireColour(true);" style="margin-left:5%;margin-bottom:10px;min-width:90%;width:90%;">CONFIRM</button>

    </div>
</div>
<div id="navbackdropCatalog" style="z-index:1;"></div>
<script type="text/javascript">
var firstDraw = true;
var loadStart = false;
var scrollTimeout = null;
function onScroll() {

    if (($("#items_div")[0].scrollTop + $("#items_div").height()) >= ($("#items_div")[0].scrollHeight - 50)) {
    loadMore();
    }
    if (($("#items_div")[0].scrollTop == 0)) {
    loadMore(false);
    }
}
function loadMore(next = true) {
$("#items_div").unbind('scroll');
clearTimeout(scrollTimeout);
if (next) {
  dTable.page('next').draw('page');
  $('#items_div').scrollTop(100);
} else {
  dTable.page('previous').draw('page');
//        $('#items_div').scrollTop(250);
}

}
function mobileAndTabletCheck() {
  var  check = false;
  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
  return check;
}
$(document).ready(function() {

  $.each($(".modal-content"), function() {
    $('<button type="button" class="close" style="position:absolute;top:10px;right:15px;" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button>').appendTo($(this));
  });

  $("#products").clone().appendTo($("#items_div"));
  $("#items_div").find("#products").attr("id", "products_temp");
//  $('<button id="loadMore" class="btn-black" onclick="loadMore();" >Load more</button>').appendTo($("#items_div"));
//$("#products_temp").find("thead").hide();
  $("#products_temp").show();
  $("#items_div").attr("sheight", $(window).height());
  var app = document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1;

  $("#items_div").css({
      height: $(window).height() - (app ? 100 : 105),
      minHeight: $(window).height() - (app ? 100 : 105),
      maxHeight: $(window).height() - (app ? 100 : 105)
  })
  var ithg = $("#items_div").height();
/*  $("#items_div").bind('scroll', function() {

    if (scrollTimeout == null) {
      scrollTimeout = setTimeout(onScroll, 500);
    } else {
      clearTimeout(scrollTimeout);
      scrollTimeout = null;
      scrollTimeout = setTimeout(onScroll, 500);
    }
  });*/
  window.addEventListener("message", receiveMessage, false);

  dTable = $('#products').DataTable({
         dom: 'Bfrtip',
         "info": false,
        "pageLength": 24,
         "processing": true,
         "serverSide": true,

         "ajax": {
             "url": "http://85.214.165.56:81/api/diamonds.php",
             "type": "POST"
         },
         "language": {
             "infoFiltered": " - filtered from _MAX_ records"
         },
         buttons: [

         ],
         "drawCallback": function(settings) {
           console.log(settings);
           if (settings.aoData.length == "0" && !$("#div_filter").is(":visible")) {
             showModal({
               type: "error",
               title: "No results",
               showCancelButton: false,
               confirmButtonText: "ADJUST SEARCH"
             })
             return false;
           }

           $("#products_temp").find("tbody").find("tr").remove();

           $.each($("#products").find("tbody").find("tr"), function(ind) {
             var tr = dTable.row($(this));
             $(this).attr("data", JSON.stringify(tr.data()));
              $(this).appendTo($("#products_temp").find("tbody"));
            })
            $("#navigation").remove();
            $('<div class="row" id="navigation" style=""><div class="col-md-6 col-xs-6"><button onclick="loadMore(false);" id="pb" class="btn-black">BACK</div><div class="col-md-6 col-xs-6"><button onclick="loadMore()" id="nb" class="btn-black">NEXT</div></div>').appendTo($("#items_div"));

          /*  setTimeout(function() {
              $("#items_div").bind('scroll', function() {

                if (scrollTimeout == null) {
                  scrollTimeout = setTimeout(onScroll, 500);
                } else {
                  clearTimeout(scrollTimeout);
                  scrollTimeout = null;
                  scrollTimeout = setTimeout(onScroll, 500);
                }
              });
            }, 1000);*/
          },
         "columns": [
             { data: "SerialNo" },
             { data: "WarehouseID" },
             { data: "ItemID" },
              {data: "CutID"},
              {data: "TotalWeight"},
             {data: "ColourID",
               "render": function ( data, type, row ) {
                 return makeAbbreviation(data);
               }
             },
             {data: "ClarityID",
               "render": function ( data, type, row ) {
                 return makeAbbreviation(data);
               }
             },

            {data: "SalesPrice",
              "render": function ( data, type, row ) {
                var cc = $("#currency").find("option:selected").val();
                var pr = (parseFloat(row["SalesPrice"])) * (parseFloat($("#currency").find("option:selected").attr("rate")));
                return parseFloat(pr).toLocaleString("nl-NL",{ style: 'currency', currency: $("#currency").val() });
              }
            },
             {data: "SerialName"},
             {data: "Discount"},
             {data: "WarehouseID"}
         ],

         "order": [[ 2, "asc" ], [4, "desc"]],
         "stateSave":  false,
     })

     var cuts = [];

     api.call("getCuts", function(res) {
         $.each(res, function() {
           if (this.CutID != null && this.CutID != "") {
             $("<div class='options_item'><span vl='" + this.CutID + "`'" + " style='float:left;'>" + this.CutID + "<span><span  style='float:right;font-size:12px;margin-top:0px;margin-left:10px;'><div class='pretty p-switch p-fill' style='float:right;margin-top:5px;'><input opt  disabled type='checkbox'  /><div class='state p-success' style='width:30px;'> <label></label></div></div></span></div>").appendTo($("#cut_options"));
             cuts.push({
               value: this.CutID + "`",
               label: this.CutID
             })
           }
         });
     }, {table: "diamonds"}, {}, {});


     var colors = [];
     $.ajax({
       url: "http://85.214.165.56:81/api/index.php?request=getColors",
       type: "GEt",
       dataType: "JSON",
       data: {
         table: "diamonds"
       },
       success: function(res) {

         $.each(res, function() {
           if (this.ColourID != null && this.ColourID != "") {
             $("<div class='options_item'><span vl='" + this.ColourID + "`'" + " style='float:left;'>" + this.ColourID + "<span><span  style='float:right;font-size:12px;margin-top:0px;margin-left:10px;'><div class='pretty p-switch p-fill' style='float:right;margin-top:5px;'><input opt  disabled type='checkbox'  /><div class='state p-success' style='width:30px;'> <label></label></div></div></span></div>").appendTo($("#colour_options"));
             colors.push({
               value: this.ColourID + "`",
               label: this.ColourID
             })
           }
         });

       }
     })
     var clarity = [];
     $.ajax({
       url: "http://85.214.165.56:81/api/index.php?request=getClarity",
       type: "GEt",
       dataType: "JSON",
       data: {
         table: "diamonds"
       },
       success: function(res) {

         $.each(res, function() {
           if (this.ClarityID != null && this.ClarityID != "") {
             $("<div class='options_item'><span vl='" + this.ClarityID + "`'" + " style='float:left;'>" + this.ClarityID + "<span><span  style='float:right;font-size:12px;margin-top:0px;margin-left:10px;'><div class='pretty p-switch p-fill' style='float:right;margin-top:5px;'><input opt  disabled type='checkbox'  /><div class='state p-success' style='width:30px;'> <label></label></div></div></span></div>").appendTo($("#clarity_options"));
             clarity.push({
               value: this.ClarityID + "`",
               label: this.ClarityID
             })
           }
         });

       }
     })
     var types = [];
     $.ajax({
       url: "http://85.214.165.56:81/api/index.php?request=getTypes",
       type: "GEt",
       dataType: "JSON",
       success: function(res) {

         $.each(res, function() {
           if (this.TypeID != null && this.TypeID != "") {
             types.push({
               value: this.TypeID + "`",
               label: this.TypeID
             })
           }
         });

       }
     })


     var locations = [];
     $.ajax({
       url: "http://85.214.165.56:81/api/index.php?request=getDiamondsLocations",
       type: "GEt",
       dataType: "JSON",
       success: function(res) {

         $.each(res, function() {
           $("<div class='options_item'><span vl='" + this.WarehouseID + "`'" + " style='float:left;'>" + this.Warehouse + "<span><span  style='float:right;font-size:12px;margin-top:0px;margin-left:10px;'><div class='pretty p-switch p-fill' style='float:right;margin-top:5px;'><input opt  disabled type='checkbox'  /><div class='state p-success' style='width:30px;'> <label></label></div></div></span></div>").appendTo($("#locations_options"));
             if (this.WarehouseID != null && this.WarehouseID != "") {
             locations.push({
               value: this.WarehouseID + "`",
               label: this.WarehouseID
             })
           }
         });

       }
     })


     var mgroups = [];
     $.ajax({
       url: "http://85.214.165.56:81/api/index.php?request=getExcangeRates",
       type: "GEt",
       dataType: "JSON",
       success: function(res) {
         $.each(res, function() {
           $('<option value="' + this.CurrencyCode + '" rate="' + (parseFloat(this.ExchangeRate) / 100) + '">' + this.Currency +'</option>').appendTo($("#currency"));
         })
         $("#currency").bind("change", function() {

           dTable.draw();
         })

       }
     })


  setTimeout(function() {

    try {
      window.parent.hideCatalog();

   } catch(err) {
     alert(err)
   }
 }, 2000);
   setTimeout(function() {
     yadcf.init(dTable, [
     {

        filter_container_id: "filter_price",
        column_number: 7,
         filter_type: "range_number",
         filter_delay: 500
     },
     {
       style_class: "form-control",
         filter_container_id: "filter_locations",
         column_number: 1,
          data: locations,
         filter_type: "multi_select",
         select_type: 'select2'
     },
     {

        filter_container_id: "filter_weight",
        column_number: 4,
         filter_type: "range_number",
         filter_delay: 500
     },
     {
       style_class: "form-control",
        filter_container_id: "filter_name",
        filter_type: "text",
         column_number: 3,
     },
     {
       style_class: "form-control",
        filter_container_id: "filter_itemid",
        filter_type: "text",
         column_number: 2,
     },
        {
          style_class: "form-control",
            filter_container_id: "filter_cut",
            column_number: 3,
             data: cuts,
            filter_type: "multi_select",
            select_type: 'select2'
        },
        {
          style_class: "form-control",
            filter_container_id: "filter_color",
            column_number: 5,
             data: colors,
            filter_type: "multi_select",
            select_type: 'select2'
        },
        {
          style_class: "form-control",
            filter_container_id: "filter_clarity",
            column_number: 6,
             data: clarity,
            filter_type: "multi_select",
            select_type: 'select2'
        },
      ]
     );
       $("#yadcf-filter--products-5").find("option").eq(0).text("Discount yes/np");
       $("#filters_temp").appendTo($("#filters_body"));
       $("#filters_temp").css({
         visibility: "visible"
       })

      collectFilters(true);
       $.each($(".options_item"), function() {
         var dv = $(this);
         dv.bind("click", function() {
           var dv = $(this).closest(".options_item");
           dv.find("[opt]")[0].checked = !dv.find("[opt]")[0].checked;
           if (dv.find("[opt]")[0].checked) {
             dv.find("[opt]").addClass("checked");
           } else {
             dv.find("[opt]").removeClass("checked");
           }
         //  alert($(this).find("[opt]")[0].onchange);
         })
       })
     }, 2000);
     function receiveMessage(event) {

       var a = event.data.split("#");
       if (a[0] == "changeCurrency") {
         $("#currency").val(a[1]);
        dTable.draw();
       }

       if (a[0] == "findID") {

       }
     }
     $('#products_temp').on('click', 'tbody tr', function() {

        var node = this;
        var data = $.parseJSON($(this).attr("data"));
        console.log(data);
        $("#product_image").attr("src", $(node).find("img").eq(0).attr("src"));
        $("#title").html(data["productName"] + " " + parseFloat(data["SalesPrice"]).toLocaleString("nl-NL",{ style: 'currency', currency: "EUR" }));
        $("#productDetail").attr("itemid", data["ItemID"]);
        $("#productDetail").modal("show");
      })
});
function collectFilters(fire = false) {
  var vals = yadcf.exGetColumnFilterVal(dTable, 2);
  $("#itemidSelected").html(vals);


  var vals = yadcf.exGetColumnFilterVal(dTable, 7);
  $("#prfrom").val(vals.from);
  $("#prto").val(vals.to);
  if (vals.from != "" || vals.to != "") {
    $("#priceSelected").html(vals.from + " - " + vals.to);
  }

  var vals = yadcf.exGetColumnFilterVal(dTable, 4);
  $("#wgfrom").val(vals.from);
  $("#wgto").val(vals.to);
  if (vals.from != "" || vals.to != "") {
    $("#weightsSelected").html(vals.from + " - " + vals.to);
  }

  var vals = yadcf.exGetColumnFilterVal(dTable, 3);
  if (vals.length > 0) {
    var vv = [];
    $.each(vals, function() {
      vv.push(this.replace("`", ""));
    });
    $("#cutSelected").html(vv.join(","));
    $.each($("#cut_options").find("input"), function() {
      if (vals.indexOf($(this).closest("[vl]").attr("vl")) > -1) {
        this.checked = true;
        $(this).addClass("checked");
      }
    })
  }

  var vals = yadcf.exGetColumnFilterVal(dTable, 6);
  if (vals.length > 0) {
    var vv = [];
    $.each(vals, function() {
      vv.push(this.replace("`", ""));
    });
    $("#claritySelected").html(vv.join(","));
    $.each($("#clarity_options").find("input"), function() {
      if (vals.indexOf($(this).closest("[vl]").attr("vl")) > -1) {
        this.checked = true;
        $(this).addClass("checked");
      }
    })
  }

  var vals = yadcf.exGetColumnFilterVal(dTable, 5);

  if (vals.length > 0) {
    var vv = [];
    $.each(vals, function() {
      vv.push(this.replace("`", ""));
    });
    $("#colourSelected").html(vv.join(","));
    $.each($("#colour_options").find("input"), function() {
      if (vals.indexOf($(this).closest("[vl]").attr("vl")) > -1) {
        this.checked = true;
        $(this).addClass("checked");
      }
    })
  }

  setTimeout(function() {
    toggleFilters();

    if (fire) {
      $("#apply").trigger("click");
    }
 }, 500);
}
function checkAddToInvoice(itemid) {
  setTimeout(function() {
        //  var row = dTable.row('#' + $("#productDetail").attr("itemid"));
          var row = $("#products_temp").find("#" + $("#productDetail").attr("itemid"));
          var data = $.parseJSON(row.attr("data"));

          var obj = {
            imageURL: "",
            SerialNo: data.SerialNo,
            Discount: data.Discount,
            productName:  data.SerialNo + " " + data.SerialName,
            SalesPrice: data["SalesPrice"],
            Discount: data["Discount"],
          }
          addToInvoice(obj);
      }, 1);
}

  function selectedFilters(mm = "") {
      if (mm != "") {
        $("#mainGroupSelected").html(mm);
      }
        var str = [];
        $.each($(".filters"), function() {
          if ($(this).find("span").eq(2).html() != "" && $(this).find("span").eq(2).html() != "Reset") {
            str.push($(this).find("span").eq(2).text());
          }
        })
      //  alert(str.join(","))
        if (str.length > 0) {
          $("#selectedFilters").html(str.join(" "));
        } else {
          $("#selectedFilters").html("");
        }

  }

function toggleFilters() {

  $('#navbackdropCatalog').toggle();
  $("#div_filter").toggle();
  selectedFilters();

    //maingroup end


//    fireMainGroups(false);
}

function uncheckOptions(optid) {
  $.each($('#' + optid).find("input"), function() {
    this.checked = false;
    $(this).removeClass("checked");
  })
}
function showFilters(group) {
  if (group == "maingroup") {
    var vals = yadcf.exGetColumnFilterVal(dTable,4);
    $.each($("#maingroup_options").find("input"), function() {
      var txt = $(this).closest(".options_item").find("span").eq(0).attr("vl");
      if (vals.indexOf(txt) > -1) {
        this.checked = true;
        $(this).addClass("checked");
      }
    })
  }
  if (group == "discount") {
      var vals = yadcf.exGetColumnFilterVal(dTable,6);
    //  alert(JSON.stringify(vals))
  }
  $("#div_filter").hide();
  $("#filters_container").hide();
  $("#" + group).show();
}
function closeFilter(group) {
  $("#div_filter").show();
  $("#filters_container").show();
  $("#" + group).hide();
}
function selectDeselect(obj) {
  var dv = $(obj).closest(".executefilters").attr("id") + "_options";
  $.each($("#" + dv).find("input"), function() {
    if (obj.checked) {
      $(this).addClass("checked");
    } else {
      $(this).removeClass("checked");
    }
    this.checked = obj.checked;
  });
}
function fireItemID(fire = false) {
  if (fire) {
    yadcf.exResetFilters(dTable, [2]);
    yadcf.exFilterColumn(dTable, [[2, $("#flitemid").val()]]);
    closeFilter("itemid");
  }
  $("#itemidSelected").html($("#flitemid").val());
//
}
function firePrice(fire = false) {
  var obj = {
    from: $("#prfrom").val(),
    to: $("#prto").val()
  }
  if (fire) {
    yadcf.exResetFilters(dTable, [7]);
    yadcf.exFilterColumn(dTable, [[7, obj]]);
    closeFilter("price");
  }
  $("#priceSelected").html($("#prfrom").val() + " - " + $("#prto").val());
//
}
function fireColour(fire = false) {
  $("#colourSelected").html("");
  var sctd = [];
  var sctd_ex = [];
  $.each($("#colour_options").find(".options_item").find("[opt]"), function() {
   if ($(this).hasClass("checked")) {
      var txt = $(this).closest(".options_item").find("span").eq(0).text();
      sctd.push(txt);
      sctd_ex.push($(this).closest(".options_item").find("span").eq(0).attr("vl"));
    }
  })

  $("#colourSelected").html(sctd.join(","));
  if (fire) {
    yadcf.exResetFilters(dTable, [5]);
    yadcf.exFilterColumn(dTable, [[5, sctd_ex]]);
    closeFilter("colour");
  }
//    yadcf.exFilterColumn(dTable, [[4, ['Rings`']]]);
//  closeFilter("colour");
}
function fireWeight(fire = false) {
  var obj = {
    from: $("#wgfrom").val(),
    to: $("#wgto").val()
  }
  if (fire) {
    yadcf.exResetFilters(dTable, [4]);
    yadcf.exFilterColumn(dTable, [[4, obj]]);
    closeFilter("weight");
  }
  $("#weightsSelected").html($("#wgfrom").val() + " - " + $("#wgto").val());
//  closeFilter("weight");
}
function fireCut(fire = false) {
  $("#cutSelected").html("");
  var sctd = [];
  var sctd_ex = [];
  $.each($("#cut_options").find(".options_item").find("[opt]"), function() {
   if ($(this).hasClass("checked")) {
      var txt = $(this).closest(".options_item").find("span").eq(0).text();
      sctd.push(txt);
      sctd_ex.push($(this).closest(".options_item").find("span").eq(0).attr("vl"));
    }
  })


  $("#cutSelected").html(sctd.join(","));
  if (fire) {
    yadcf.exResetFilters(dTable, [3]);
    yadcf.exFilterColumn(dTable, [[3, sctd_ex]]);
    closeFilter("cut");
  }
//    yadcf.exFilterColumn(dTable, [[4, ['Rings`']]]);
//
}

function fireLocations(fire = false) {
  $("#locationsSelected").html("");
  var sctd = [];
  var sctd_ex = [];
  $.each($("#locations_options").find(".options_item").find("[opt]"), function() {
   if ($(this).hasClass("checked")) {
      var txt = $(this).closest(".options_item").find("span").eq(0).text();
      sctd.push(txt);
      sctd_ex.push($(this).closest(".options_item").find("span").eq(0).attr("vl"));
    }
  })

  $("#locationsSelected").html(sctd.join(","));
  if (fire) {
    yadcf.exResetFilters(dTable, [1]);
    yadcf.exFilterColumn(dTable, [[1, sctd_ex]]);
    closeFilter("locations");
  }
//    yadcf.exFilterColumn(dTable, [[4, ['Rings`']]]);
//
}


function fireClarity(fire = false) {
  $("#claritySelected").html("");
  var sctd = [];
  var sctd_ex = [];
  $.each($("#clarity_options").find(".options_item").find("[opt]"), function() {
   if ($(this).hasClass("checked")) {
      var txt = $(this).closest(".options_item").find("span").eq(0).text();
      sctd.push(txt);
      sctd_ex.push($(this).closest(".options_item").find("span").eq(0).attr("vl"));
    }
  })

  $("#claritySelected").html(sctd.join(","));
  if (fire) {
    yadcf.exResetFilters(dTable, [6]);
    yadcf.exFilterColumn(dTable, [[6, sctd_ex]]);
    closeFilter("clarity");
  }
//    yadcf.exFilterColumn(dTable, [[4, ['Rings`']]]);
  //
}
function sortTable() {

  if ($("#sortOrder").hasClass("asc")) {
    var ordrs = [[3, "asc"],[$("#ssort").val(), "asc"]];
  } else {
    var ordrs = [[3, "asc"],[$("#ssort").val(), "desc"]];
  }
  dTable
    .order( ordrs )
    .draw();

}
function fireClosest(obj) {
  $(obj).closest(".executefilters").find(".btn-black").trigger("click");
}
function changeCurrency(v) {
  $("#currency").val(v);
  dTable.draw();
}
function reset() {
  $('.all').trigger('click');
}
function findID(id) {

 if (id == "") {
   yadcf.exResetFilters(dTable, [2]);
   $("itemidSelected").html("");
    selectedFilters();
   return;
 }
  $('.all').trigger('click');
  $("#flitemid").val(id);
  yadcf.exResetFilters(dTable, [2]);
  yadcf.exFilterColumn(dTable, [[2, $("#flitemid").val()]]);
  $("#itemidSelected").html($("#flitemid").val());
   selectedFilters();
}
</script>
<style>
td.dataTables_empty {
text-align: center;
font-size: 18px;
margin-top:40px;
}
span.all {

float:right;
font-size: 13px;
}
#div_filter {
z-index: 2;
min-width:100%;
width: 100%;
padding-left: 8px;
padding-right: 10px;
min-height: calc(100vh - 40px);
position:absolute;
top:0px;
display: none;
font-family: 'Open Sans';
}
#filters_container {
font-family: 'Open Sans';
background: white;
position:relative;
top: 0px;
min-width:calc(100% - 33px);
min-height: calc(100vh - 40px);
}
.filters {
width:100%;
min-width:100%;
display:grid;
}
.options {
width:100%;
font-family: 'Open Sans';
padding-top: 5px;
padding-bottom: 5px;
border-bottom: 1px solid #e2e2e2;
font-size: 17px;
min-width:100%;
max-height: calc(100vh - 157px);
overflow: auto;
display:grid;
overflow-x: hidden;
}
.options_item {
width:100%;
font-family: 'Open Sans';
padding-top: 5px;
padding-bottom: 5px;
border-bottom: 1px solid #e2e2e2;
font-size: 17px;
min-width:100%;
display:grid;
}
.filters.border {
padding-top:2px;
padding-bottom:2px;
border-bottom: 1px solid #DFDFDF;
}
.executefilters {
padding: 10px;
z-index: 3000;
display:none;
position: fixed;
 font-size:17px;
 left: 50%;
 -webkit-transform: translate(-50%, -0%);
 transform: translate(-50%, -0%);
 top: 10px;
min-width:95%;
width:95%;
background:white;
}
.arrow_left {
min-width:30px;
float:left;
background-image:url(/images/arrow_left.png);
background-repeat:no-repeat;
background-position: left center;
min-height:30px;
background-size:contain;
}
.filter_group {
margin-bottom: 10px;
font-size:21px;
width:100%;

}
.dataTables_paginate.paging_simple_numbers {
display: none;
}
#products_wrapper {
display: none;
}
#content {
  overflow: hidden;
}
#items_div {
    padding-left: 3px;
    padding-right: 7px;
    overflow: auto;
    overflow-x: auto;
    height: calc(100vh - 170px);
    max-height: calc(100vh - 170px);
    min-height: calc(100vh - 170px);
    position:relative;
    top:10px;
}
#products_temp tr td {
padding: 3px;
font-size: 12px;
}
#products_temp tr.odd {
background-color: #f6f6f6;
}
.sort {
  min-width: 30px;
  position:absolute;
  right: 37px;
  height:22px;
  min-height: 22px;
  top:13px;
  width:30px;
  background-image: url(http://85.214.165.56:81/costerdemo/coster/www/images/down.png);
  background-size:contain;
  background-repeat: no-repeat;
  background-position: center center;
}
.sort.asc {
  background-image: url(http://85.214.165.56:81/costerdemo/coster/www/images/up.png);
}
</style>
